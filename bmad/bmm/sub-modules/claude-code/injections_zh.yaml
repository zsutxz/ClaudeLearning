# Claude Code 内容注入配置
# 此文件定义在安装 Claude Code 作为 IDE 时，在 BMAD 文件的特定点注入的内容
#
# 安装程序将：
# 1. 询问用户是否要安装子代理（全部/选择性/无）
# 2. 询问安装位置（项目级 .claude/agents/ 或用户级 ~/.claude/agents/）
# 3. 只注入与选定子代理相关的内容
# 4. 模板保留在 bmad/ 目录中并从那里引用
# 5. 注入放置在每个子代理最有价值的特定部分

injections:
  # ===== PRD 工作流程注入 =====

  # PRD 子代理指令
  - file: "bmad/bmm/workflows/prd/instructions.md"
    point: "prd-subagent-instructions"
    requires: "all-prd-subagents"
    content: |

      **子代理使用**: 在整个工作流程中，在关键决策点利用专门的子代理：
      - <CRITICAL>定义功能需求时使用 `bmm-requirements-analyst`</CRITICAL>
      - <CRITICAL>全面的旅程映射使用 `bmm-user-journey-mapper`</CRITICAL>
      - <CRITICAL>构建史诗边界时使用 `bmm-epic-optimizer`</CRITICAL>
      - <CRITICAL>捕获所有技术提及使用 `bmm-technical-decisions-curator`</CRITICAL>

  # PRD 需求分析
  - file: "bmad/bmm/workflows/prd/instructions.md"
    point: "prd-requirements-analysis"
    requires: "requirements-analyst"
    content: |

      **子代理提示**: 使用 `bmm-requirements-analyst` 验证需求是可测试和完整的。

  # PRD 用户旅程映射
  - file: "bmad/bmm/workflows/prd/instructions.md"
    point: "prd-user-journey"
    requires: "user-journey-mapper"
    content: |

      **子代理提示**: 使用 `bmm-user-journey-mapper` 映射所有用户类型及其价值路径。

  # PRD 史诗优化
  - file: "bmad/bmm/workflows/prd/instructions.md"
    point: "prd-epic-optimization"
    requires: "epic-optimizer"
    content: |

      **子代理提示**: 使用 `bmm-epic-optimizer` 验证史诗边界交付连贯的价值。

  # PRD 文档审查
  - file: "bmad/bmm/workflows/prd/instructions.md"
    point: "prd-checklist-review"
    requires: "document-reviewer"
    content: |

      **子代理提示**: 在最终确定前使用 `bmm-document-reviewer` 验证 PRD 完整性。

  # 技术决策策展人
  - file: "bmad/bmm/workflows/prd/instructions.md"
    point: "technical-decisions-curator"
    requires: "technical-decisions-curator"
    content: |

      **自动捕获**: 应在以下情况调用 `bmm-technical-decisions-curator`：
      - 提及技术、框架或工具
      - 讨论架构模式
      - 出现基础设施或部署主题
      - 指定集成需求

  # ===== 市场研究模板注入 =====

  # 市场 TAM/SAM/SOM 计算
  - file: "bmad/bmm/templates/market.md"
    point: "market-tam-calculations"
    requires: "data-analyst"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-data-analyst' 子代理执行所有 TAM、SAM 和 SOM 计算。</i>
        <i>子代理将应用适当的方法论，验证假设，并提供可辩护的市场规模。</i>
      </llm>

  # 市场趋势分析
  - file: "bmad/bmm/templates/market.md"
    point: "market-trends-analysis"
    requires: "trend-spotter"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-trend-spotter' 子代理识别和分析新兴市场趋势。</i>
        <i>子代理将检测颠覆信号、技术转变和未来机会。</i>
      </llm>

  # 市场客户人物画像
  - file: "bmad/bmm/templates/market.md"
    point: "market-customer-segments"
    requires: "user-researcher"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-user-researcher' 子代理开发详细的客户细分档案和人物画像。</i>
        <i>子代理将分析每个细分的行为模式、需求和旅程地图。</i>
      </llm>

  # 市场研究审查
  - file: "bmad/bmm/templates/market.md"
    point: "market-executive-summary"
    requires: "document-reviewer"
    content: |

      <llm critical="true">
        <i>强制要求：在最终确定执行摘要之前，使用 'bmm-document-reviewer' 子代理验证所有市场研究发现并确保数据准确性。</i>

  # ===== 竞争对手分析模板注入 =====

  # 竞争对手情报收集
  - file: "bmad/bmm/templates/competitor.md"
    point: "competitor-intelligence"
    requires: "market-researcher"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-market-researcher' 子代理为每个竞争对手档案收集全面的竞争情报。</i>
        <i>子代理将分析定位、战略和市场动态。</i>
      </llm>

  # 竞争对手技术分析
  - file: "bmad/bmm/templates/competitor.md"
    point: "competitor-tech-stack"
    requires: "technical-evaluator"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-technical-evaluator' 子代理分析和比较竞争对手技术栈。</i>
        <i>子代理将识别技术差异化和架构优势。</i>
      </llm>

  # 竞争对手指标分析
  - file: "bmad/bmm/templates/competitor.md"
    point: "competitor-metrics"
    requires: "data-analyst"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-data-analyst' 子代理分析竞争对手绩效指标和市场份额数据。</i>

  # 竞争对手分析审查
  - file: "bmad/bmm/templates/competitor.md"
    point: "competitor-executive-summary"
    requires: "document-reviewer"
    content: |

      <llm critical="true">
        <i>强制要求：在最终确定之前，使用 'bmm-document-reviewer' 子代理验证竞争分析完整性和战略建议。</i>

  # ===== 项目简介模板注入 =====

  # 简介问题验证
  - file: "bmad/bmm/templates/brief.md"
    point: "brief-problem-validation"
    requires: "market-researcher"
    content: |

      <llm critical="true">
        <i>如果市场研究尚未作为输入提供，强制要求：使用 'bmm-market-researcher' 子代理验证问题陈述并评估市场机会。</i>
      </llm>

  # 简介目标用户分析
  - file: "bmad/bmm/templates/brief.md"
    point: "brief-user-analysis"
    requires: "user-researcher"
    content: |

      <llm critical="true">
        <i>如果目标用户分析尚未提供，强制要求：使用 'bmm-user-researcher' 子代理开发详细的用户档案并验证用户需求。</i>
      </llm>

  # 简介成功指标
  - file: "bmad/bmm/templates/brief.md"
    point: "brief-success-metrics"
    requires: "data-analyst"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-data-analyst' 子代理定义和验证 KPI、成功指标和测量方法。</i>
      </llm>

  # 简介技术可行性
  - file: "bmad/bmm/templates/brief.md"
    point: "brief-technical-feasibility"
    requires: "technical-evaluator"
    content: |

      <llm critical="true">
        <i>如果技术假设需要验证，使用 'bmm-technical-evaluator' 子代理评估可行性并识别技术风险。</i>
      </llm>

  # 简介需求提取
  - file: "bmad/bmm/templates/brief.md"
    point: "brief-requirements"
    requires: "requirements-analyst"
    content: |

      <llm critical="true">
        <i>强制要求：使用 'bmm-requirements-analyst' 子代理从简介内容中提取初始高级需求。</i>
      </llm>

  # 简介文档审查
  - file: "bmad/bmm/templates/brief.md"
    point: "brief-final-review"
    requires: "document-reviewer"
    content: |

      <llm critical="true">
        <i>强制要求：在最终确定简介之前，使用 'bmm-document-reviewer' 子代理确保完整性和内部一致性。</i>

# 要复制的子代理
subagents:
  source: "sub-agents"
  target: ".claude/agents"
  files:
    - "market-researcher.md"          # 市场研究员
    - "requirements-analyst.md"       # 需求分析师
    - "technical-evaluator.md"        # 技术评估师
    - "epic-optimizer.md"             # 史诗优化器
    - "document-reviewer.md"          # 文档审查员
    - "codebase-analyzer.md"          # 代码库分析师
    - "dependency-mapper.md"          # 依赖映射器
    - "pattern-detector.md"           # 模式检测器
    - "tech-debt-auditor.md"          # 技术债务审计员
    - "api-documenter.md"             # API 文档师
    - "test-coverage-analyzer.md"     # 测试覆盖率分析师
    - "user-researcher.md"            # 用户研究员
    - "user-journey-mapper.md"        # 用户旅程映射器
    - "technical-decisions-curator.md" # 技术决策策展人
    - "data-analyst.md"               # 数据分析师
    - "trend-spotter.md"              # 趋势发现者