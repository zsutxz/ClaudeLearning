鞭炮连锁爆炸测试
-------------------------------

(CC-BY-NC-SA 4.0 by karminski-牙医)

请使用 three.js 实现一个逼真的"鞭炮箱子"3D爆炸连锁反应演示。所有代码（包括HTML、CSS、JavaScript）必须封装在一个独立的HTML文件中。

**场景设置：**

1.  **地面平面：** 创建一个1000×1000的灰色、光滑的水平平面，可以接收阴影。地面材质使用 `{color: 0x808080, roughness: 0.8, metalness: 0.1}`。

2.  **鞭炮建模：**
    *   **主体：** 红色圆柱体，高度1，直径0.2，材质使用 `{color: 0xff0000, roughness: 0.6, metalness: 0.2}`
    *   **封盖：** 主体圆柱体顶部和底部的土黄色小圆柱体，高度0.05，材质 `{color: 0xdaa520, roughness: 0.8}`
    *   **引线：** 从顶部封盖中心伸出的蓝绿色细圆柱，长度0.5，直径0.05，材质 `{color: 0x20b2aa, roughness: 0.4}`
    *   **碰撞体积：** 鞭炮之间有碰撞体积，防止模型重叠
    *   **燃烧状态：** 引线顶端需要能显示小的橙红色发光球体来模拟火星

3.  **透明箱子：**
    *   **尺寸：** 10×10×8的透明玻璃箱子，顶部没有碰撞体积，其他面有碰撞体积，材质 `{color: 0xffffff, transparent: true, opacity: 0.15, roughness: 0.1, metalness: 0.0}`
    *   **箱子内部：** 动画开始时，从箱子上方5个单位高度处按每组10个随机生成鞭炮，总计生成10组，鞭炮自由落体到箱子内部
    *   **箱子位置：** 放置在平面中心偏后的位置

**爆炸与连锁反应模拟：**

1.  **触发机制：**
    *   页面底部提供"开始燃放"按钮来触发动画
    *   一个已点燃的鞭炮以抛物线轨迹从上方落入箱子中

2.  **引线燃烧效果：**
    *   **燃烧动画：** 引线在2秒内从顶端向下逐渐缩短，燃烧部分显示橙红色发光效果

3.  **爆炸效果：**
    *   **瞬间替换：** 鞭炮爆炸瞬间消失，替换为大量彩色纸屑碎片
    *   **纸屑系统：** 生成50-80个小的彩色方形/矩形碎片，颜色为红色
    *   **爆炸冲击波：** 产生球形扩散的透明冲击波效果，影响周围鞭炮
    *   **碎片物理：** 纸屑具有初始向外的速度，受重力影响，有随机旋转动画

4.  **冲击力与弹射：**
    *   **影响范围：** 爆炸中心半径2-3单位内的鞭炮受到冲击
    *   **弹射动画：** 被冲击的鞭炮以随机方向和力度弹开1-5单位距离
    *   **旋转效果：** 弹射的鞭炮具有随机的翻滚旋转动画
    *   **碰撞检测：** 弹射的鞭炮与箱壁、地面产生反弹效果

5.  **火光传播与连锁反应：**
    *   **火光范围：** 每次爆炸产生半径3单位的球形火光区域，持续0.5-1秒
    *   **引燃机制：** 火光范围内未爆炸鞭炮的引线自动点燃，开始1秒燃烧倒计时
    *   **传播延迟：** 不同鞭炮的引燃有0.1-0.3秒的随机延迟，避免同时爆炸
    *   **连锁扩散：** 形成真实的多米诺骨牌式连锁反应

6.  **环境交互效果：**
    *   **地面冲击：** 落地的鞭炮和碎片在地面产生小的冲击反弹
    *   **碎片堆积：** 纸屑碎片最终散落在地面和箱子周围，形成堆积效果

**高级视觉效果：**

1.  **增强粒子系统：**
    *   **火花粒子：** 燃烧引线和爆炸时产生明亮的火花，具有拖尾效果
    *   **烟雾效果：** 爆炸后产生灰白色烟雾粒子，缓慢上升并逐渐消散
    *   **光晕效果：** 爆炸瞬间产生明亮的光晕，照亮周围区域

2.  **动态光照：**
    *   **爆炸闪光：** 每次爆炸时创建瞬间的点光源，模拟爆炸闪光
    *   **引线火光：** 燃烧的引线产生小的动态点光源
    *   **颜色温度：** 光源颜色从橙红色到亮白色变化

**光照与渲染设置：**

1.  **光源配置：**
    *   **主光源：** 45度角的定向光 `DirectionalLight`，强度1.2，能投射阴影
    *   **环境光：** 强度0.4的环境光，确保场景无纯黑区域
    *   **动态光源：** 爆炸和燃烧产生的临时点光源

2.  **阴影系统：**
    *   启用渲染器阴影贴图 `renderer.shadowMap.enabled = true`
    *   所有鞭炮和箱子能投射阴影 `castShadow = true`
    *   地面接收阴影 `receiveShadow = true`
    *   动态阴影更新以体现运动物体

3.  **后期效果：**
    *   爆炸时启用临时的屏幕闪白效果
    *   可选择性添加轻微的镜头震动效果

**相机与控制：**

*   相机从斜45度角俯视整个场景，距离箱子约15单位
*   可鼠标控制
*   确保能完整观察到连锁反应的全过程和碎片散落效果

**代码结构要求：**

*   创建独立的 `Firecracker` 类来管理单个鞭炮状态
*   创建 `ExplosionSystem` 类来管理爆炸效果和粒子
*   创建 `ChainReactionManager` 类来控制连锁反应逻辑
*   所有物理计算使用简化但真实的运动方程
*   代码中添加详细注释，特别是爆炸传播和物理模拟部分
*   性能优化：合理控制粒子数量

**交互控制：**

*   提供"重置场景"按钮重新开始演示
*   可选择添加"单个引爆"模式，点击特定鞭炮进行局部引爆测试
*   显示当前未爆炸鞭炮数量和已发生爆炸次数的统计信息