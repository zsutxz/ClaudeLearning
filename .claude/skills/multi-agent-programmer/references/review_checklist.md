# 代码审查检查清单

本文档由 Review Agent 使用，用于系统化地审查代码质量。

---

## 审查信息

| 字段 | 值 |
|------|-----|
| **审查ID** | REVIEW-YYYYMMDD-001 |
| **关联需求** | REQ-YYYYMMDD-001 |
| **审查时间** | YYYY-MM-DD HH:MM |
| **审查代理** | Review Agent |
| **代码作者** | Code Agent |

---

## 审查评分标准

| 严重程度 | 描述 | 处理要求 |
|----------|------|----------|
| 🔴 **严重 (Critical)** | 安全漏洞、数据损坏风险、核心功能缺陷 | 必须修复 |
| 🟠 **重要 (Major)** | 功能缺陷、性能问题、可维护性问题 | 应该修复 |
| 🟡 **次要 (Minor)** | 代码风格、小优化建议 | 可选修复 |
| 💡 **建议 (Suggestion)** | 改进建议、最佳实践 | 未来考虑 |

---

## 1. 需求覆盖度检查

### 1.1 功能完整性

| 功能点 | 实现状态 | 备注 |
|--------|----------|------|
| [需求中的功能1] | ✅ 已实现 / ⚠️ 部分实现 / ❌ 未实现 | [说明] |
| [需求中的功能2] | ✅ 已实现 / ⚠️ 部分实现 / ❌ 未实现 | [说明] |

**覆盖率评估：** ___ / ___ (___%)

### 1.2 验收标准验证

| 验收标准 | 验证结果 | 证据/说明 |
|----------|----------|-----------|
| [标准1] | ✅ 通过 / ❌ 未通过 | [说明] |
| [标准2] | ✅ 通过 / ❌ 未通过 | [说明] |

---

## 2. 代码质量检查

### 2.1 代码可读性

- [ ] **命名规范**
  - [ ] 变量/函数名清晰描述用途
  - [ ] 遵循项目命名约定
  - [ ] 避免缩写和单字母命名（除循环变量）

- [ ] **代码结构**
  - [ ] 函数单一职责，长度合理（< 50 行）
  - [ ] 嵌套层级不超过 3 层
  - [ ] 逻辑流程清晰易懂

- [ ] **注释文档**
  - [ ] 复杂逻辑有注释说明
  - [ ] 公共函数有文档字符串
  - [ ] 注释准确且与代码同步

### 2.2 代码组织

- [ ] **模块化**
  - [ ] 相关功能组织在一起
  - [ ] 合理的文件/目录结构
  - [ ] 模块间依赖清晰

- [ ] **重复代码**
  - [ ] 无明显代码重复
  - [ ] 相似逻辑已提取为函数

### 2.3 设计模式

- [ ] 遵循项目既定模式
- [ ] 使用适当的设计模式
- [ ] 接口设计合理

---

## 3. 安全性检查

### 3.1 输入验证 🔴

- [ ] 所有用户输入都经过验证
- [ ] 防止注入攻击（SQL/命令/XSS）
- [ ] 输入长度和格式限制

### 3.2 认证授权 🔴

- [ ] 敏感操作需要认证
- [ ] 权限检查正确实施
- [ ] 会话管理安全

### 3.3 数据保护 🔴

- [ ] 敏感数据加密存储
- [ ] 密码/密钥不在日志中
- [ ] 敏感信息不在错误消息中暴露

### 3.4 依赖安全

- [ ] 使用最新稳定版本的依赖
- [ ] 无已知安全漏洞的依赖

---

## 4. 错误处理检查

### 4.1 异常处理 🟠

- [ ] 关键操作有 try-catch 保护
- [ ] 异常被适当捕获和处理
- [ ] 不吞没异常（空 except）

### 4.2 错误消息 🟠

- [ ] 用户友好的错误提示
- [ ] 错误消息包含有用的调试信息
- [ ] 避免暴露内部实现细节

### 4.3 日志记录 🟠

- [ ] 关键操作有日志记录
- [ ] 错误日志包含上下文信息
- [ ] 日志级别使用恰当

---

## 5. 性能检查

### 5.1 算法效率 🟠

- [ ] 时间复杂度合理
- [ ] 避免不必要的嵌套循环
- [ ] 大数据集有优化措施

### 5.2 资源使用 🟠

- [ ] 无内存泄漏风险
- [ ] 文件/连接正确关闭
- [ ] 缓存策略合理

### 5.3 数据库/网络 🟠

- [ ] 查询优化（避免 N+1）
- [ ] 批量操作代替循环调用
- [ ] 有超时和重试机制

---

## 6. 边界情况检查

### 6.1 输入边界 🟠

- [ ] 空值/None 处理
- [ ] 空集合处理
- [ ] 极端值处理（最大/最小/零）

### 6.2 并发场景 🟠

- [ ] 线程安全（如适用）
- [ ] 竞态条件处理
- [ ] 死锁风险

### 6.3 异常场景 🟠

- [ ] 外部服务失败处理
- [ ] 网络超时处理
- [ ] 资源耗尽处理

---

## 7. 可维护性检查

### 7.1 可测试性 🟡

- [ ] 代码易于单元测试
- [ ] 依赖注入便于 mock
- [ ] 测试覆盖关键路径

### 7.2 可扩展性 🟡

- [ ] 易于添加新功能
- [ ] 配置与代码分离
- [ ] 硬编码值最小化

### 7.3 向后兼容 🟡

- [ ] API 变更有说明
- [ ] 数据迁移路径清晰
- [ ] 旧版本 graceful degradation

---

## 8. 项目规范检查

### 8.1 编码规范 🟡

- [ ] 遵循项目代码风格指南
- [ ] 一致的格式化
- [ ] 适当的文件/类命名

### 8.2 项目约定 🟡

- [ ] 遵循项目架构模式
- [ ] 使用项目通用工具/库
- [ ] 符合团队开发流程

---

## 9. 文档检查

### 9.1 代码文档 🟡

- [ ] 公共 API 有文档
- [ ] 复杂算法有说明
- [ ] 配置项有注释

### 9.2 变更文档 🟡

- [ ] README/CHANGELOG 更新
- [ ] 新功能有使用说明
- [ ] 破坏性变更已标注

---

## 10. 具体问题清单

### 🔴 严重问题（必须修复）

| # | 问题位置 | 问题描述 | 建议 | 优先级 |
|---|----------|----------|------|--------|
| 1 | `file:line` | [描述] | [修复建议] | P0 |

### 🟠 重要问题（应该修复）

| # | 问题位置 | 问题描述 | 建议 | 优先级 |
|---|----------|----------|------|--------|
| 1 | `file:line` | [描述] | [修复建议] | P1 |

### 🟡 次要问题（可选修复）

| # | 问题位置 | 问题描述 | 建议 | 优先级 |
|---|----------|----------|------|--------|
| 1 | `file:line` | [描述] | [修复建议] | P2 |

### 💡 改进建议

| # | 位置 | 建议 |
|---|------|------|
| 1 | `file:line` | [描述] |

---

## 审查结论

### 总体评分

| 维度 | 评分 (1-5) | 说明 |
|------|-----------|------|
| 需求覆盖 | ___ / 5 | [说明] |
| 代码质量 | ___ / 5 | [说明] |
| 安全性 | ___ / 5 | [说明] |
| 性能 | ___ / 5 | [说明] |
| 可维护性 | ___ / 5 | [说明] |

**综合评分：** ___ / 25

### 审查决策

- [ ] **通过** - 代码质量良好，可以合并
- [ ] **有条件通过** - 修复严重问题后可以合并
- [ ] **需要修改** - 存在重要问题，需要修改后重新审查
- [ ] **不通过** - 存在严重问题，需要大幅修改

### 审查摘要

```
[2-3 句话总结审查结果，包括：
1. 整体评价
2. 主要问题
3. 后续行动建议]
```

---

## Review Agent 使用说明

### 审查流程

1. **快速扫描**（1-2 分钟）
   - 浏览整体代码结构
   - 识别明显问题

2. **详细检查**（按清单逐项）
   - 对照检查清单逐项验证
   - 记录发现的问题

3. **编写报告**
   - 填写问题清单
   - 提供具体修复建议
   - 给出审查结论

4. **与 Code Agent 沟通**
   - 用建设性语言
   - 解释问题原因
   - 提供示例代码

### 审查原则

1. **关注代码而非人**：评论针对代码，不针对开发者
2. **解释原因**：说明为什么是问题，而不只是指出问题
3. **提供建议**：给出具体的改进方案
4. **承认不确定**：如果不确定，标记出来讨论

### 审查效率

- 对于大型改动，分模块审查
- 使用自动化工具辅助（linter, type checker）
- 关注高价值问题（安全、正确性、可维护性）

---

*Review Agent 注意事项：*
1. 优先检查严重性和重要性问题
2. 建议要具体可操作，避免模糊描述
3. 平衡严格性和实用性，不追求完美
4. 及时反馈，避免问题积累
