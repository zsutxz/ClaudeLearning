---
name: multi-agent-programmer
description: Use this skill when implementing complex programming tasks that benefit from multi-agent collaboration. This skill coordinates a Master LLM (orchestrator) with specialized agents (Requirements Agent, Code Agent, Review Agent) to deliver high-quality software through a structured development workflow.
---

# Multi-Agent Programmer

协调多代理协作完成复杂编程任务的专业技能。通过主控LLM（Master）协调需求分析、代码实现和代码审查三个专业代理，实现结构化、高质量的软件开发流程。

## 使用时机

在以下场景使用此技能：

- **复杂功能开发**：需要多步骤分析、设计和实现的功能
- **代码重构**：涉及多个文件和架构调整的重构任务
- **系统集成**：需要理解现有代码库并添加新功能
- **质量要求高**：需要经过严格审查的代码实现
- **需求不明确**：需要深入分析才能实现的模糊需求

不适合的场景：
- 简单的单文件修改
- 明确的Bug修复（单行或少量代码变更）
- 文档生成或简单配置修改

## 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                    Master LLM (主控)                     │
│              职责：流程协调、任务分发、决策               │
└─────────────┬───────────┬───────────────┬───────────────┘
              │           │               │
              ▼           ▼               ▼
┌─────────────────┐ ┌─────────────┐ ┌─────────────────┐
│ Requirements    │ │    Code     │ │     Review      │
│    Agent        │ │   Agent     │ │     Agent       │
│  (需求分析)      │ │  (代码实现)  │ │   (代码审查)     │
└─────────────────┘ └─────────────┘ └─────────────────┘
```

## 代理角色定义

### Master LLM (主控代理)

**职责**：
- 整体流程控制和协调
- 任务分解和分发
- 代理间通信桥接
- 最终决策和质量把关

**能力要求**：
- 全局视野和决策能力
- 任务优先级判断
- 冲突解决和协调
- 上下文管理

### Requirements Agent (需求代理)

**职责**：
- 分析和理解用户需求
- 识别技术细节和约束条件
- 明确功能边界和验收标准
- 输出详细的技术规格说明

**输入**：用户原始需求
**输出**：结构化需求文档（参考 `references/requirement_template.md`）

**能力配置**：
- 高度分析性和细致性
- 强调技术细节
- 关注边界情况
- 输出结构化文档

### Code Agent (代码代理)

**职责**：
- 根据需求规格实现代码
- 遵循项目代码规范
- 实现核心功能和边界情况处理
- 编写必要的注释和文档

**输入**：需求规格文档
**输出**：实现代码和修改说明

**能力配置**：
- 代码生成和实现导向
- 遵循最佳实践
- 注重可维护性
- 完整性思维

### Review Agent (审查代理)

**职责**：
- 审查代码质量和正确性
- 检查安全漏洞和潜在问题
- 验证需求覆盖度
- 提出改进建议

**输入**：实现代码 + 需求规格
**输出**：审查报告和改进建议

**能力配置**：
- 批判性和审查性思维
- 安全和质量意识
- 细节观察力
- 建设性反馈

## 执行流程

### 阶段 1：需求分析 (Requirements Agent)

1. **加载需求模板**
   ```
   使用 Read 工具加载：references/requirement_template.md
   ```

2. **执行需求分析**
   - 理解用户意图和目标
   - 识别功能需求和非功能需求
   - 分析技术约束和依赖
   - 定义验收标准

3. **输出需求文档**
   - 使用模板生成结构化文档
   - 包含：功能描述、技术规格、验收标准、边界情况

### 阶段 2：代码实现 (Code Agent)

1. **分析现有代码库**（如需要）
   - 使用 Glob 查找相关文件
   - 使用 Read 理解现有结构
   - 识别需要修改的部分

2. **生成实现代码**
   - 遵循需求规格文档
   - 应用项目代码规范
   - 处理错误和边界情况

3. **输出实现结果**
   - 使用 Edit/Write 工具修改/创建文件
   - 提供代码变更说明

### 阶段 3：代码审查 (Review Agent)

1. **加载审查检查清单**
   ```
   使用 Read 工具加载：references/review_checklist.md
   ```

2. **执行代码审查**
   - 检查代码质量和规范
   - 验证需求覆盖度
   - 识别安全和性能问题
   - 评估可维护性

3. **输出审查报告**
   - 使用模板生成报告
   - 包含：问题清单、严重程度、改进建议

### 阶段 4：迭代优化 (Master 协调)

1. **审查反馈处理**
   - 如果审查通过：进入最终确认
   - 如果发现问题：返回 Code Agent 进行修正

2. **迭代循环**
   - 最多进行 3 轮审查-修正循环
   - Master 判断是否满足质量标准

3. **最终确认**
   - 生成变更摘要
   - 标记任务完成

## 使用指南

### 启动技能

当用户提出编程任务时，Master 首先判断是否需要使用此技能：

```
判断标准：
- 任务复杂度 > 简单修改
- 涉及文件数 > 3
- 需要需求分析 = 是
- 质量要求 = 高
```

### 执行模式

**模式 A：顺序执行**（默认）
- 需求 → 代码 → 审查 → 完成

**模式 B：迭代执行**
- 需求 → 代码 → 审查 → [修正 → 审查] × N → 完成

**模式 C：并行探索**（复杂任务）
- 需求分解 → 多个代码任务并行 → 统一审查 → 集成

### 上下文管理

为避免上下文溢出，采用以下策略：
- Master 维护全局状态摘要
- 各代理仅关注其职责相关的上下文
- 使用 `scripts/` 中的工具进行中间数据传递

## 资源文件

### 必需资源

**需求模板**：`references/requirement_template.md`
- 定义需求文档的标准格式
- 包含所有必需字段
- 提供填写示例

**审查检查清单**：`references/review_checklist.md`
- 代码审查的标准检查项
- 安全、性能、可维护性检查点
- 问题严重程度分级标准

### 可选资源

**项目规范**：`references/project_conventions.md`
- 项目特定的编码规范
- 架构模式和设计原则
- 依赖和工具使用指南

## 脚本工具

**协调器脚本**：`scripts/agent_coordinator.py`
- 自动化代理间通信
- 管理任务状态和上下文传递
- 生成执行报告

## 最佳实践

### Master 协调原则

1. **明确任务边界**：每个代理的职责清晰
2. **控制上下文大小**：定期摘要和清理
3. **及时决策**：避免无限循环
4. **透明沟通**：向用户报告进展

### 需求分析原则

1. **追问细节**：不做出假设
2. **结构化输出**：便于后续代理理解
3. **定义验收标准**：明确成功条件

### 代码实现原则

1. **先理解后修改**：阅读相关文件
2. **遵循现有模式**：保持一致性
3. **完整实现**：包括错误处理

### 代码审查原则

1. **建设性批评**：指出问题并提供解决方案
2. **分级评估**：区分必须修复和可选改进
3. **验证完整性**：确保需求全部覆盖

## 输出格式

### 最终交付物

任务完成后，Master 应生成包含以下内容的交付报告：

```markdown
# 任务完成报告

## 需求摘要
[简短描述需求和目标]

## 实现概述
[列出修改的文件和主要变更]

## 审查结果
- 通过项目：X / Y
- 问题数量：Z 个（已解决）
- 审查结论：[通过/有保留/不通过]

## 变更文件清单
- `path/to/file1.ext`：变更说明
- `path/to/file2.ext`：变更说明

## 后续建议
[可选：改进建议或注意事项]
```

## 故障排除

### 常见问题

**问题 1：上下文溢出**
- 症状：代理失去之前讨论的内容
- 解决：Master 定期生成状态摘要，清理历史

**问题 2：需求理解偏差**
- 症状：代码不符合预期
- 解决：Requirements Agent 增加确认环节

**问题 3：无限审查循环**
- 症状：Review Agent 和 Code Agent反复争论
- 解决：Master 强制决策，设置最大迭代次数

## 扩展开发

### 添加新代理

要添加新的专业代理：

1. 在 `references/` 中创建代理角色定义文件
2. 在 SKILL.md 中添加代理描述
3. 更新执行流程以集成新代理

### 自定义工作流

可以调整代理协作模式：
- 串行：一个接一个执行
- 并行：多个代理同时工作
- 层级：代理调用子代理

## 示例场景

### 场景 1：新功能开发

```
用户请求："添加用户认证功能"

Master: 启动多代理流程
→ Requirements Agent: 分析认证需求（OAuth/JWT/Session）
→ Code Agent: 实现认证中间件和路由
→ Review Agent: 检查安全性（CSRF/注入/会话管理）
→ Master: 确认完成，生成报告
```

### 场景 2：代码重构

```
用户请求："重构数据处理层，使其更易测试"

Master: 启动多代理流程
→ Requirements Agent: 分析当前架构，定义重构目标
→ Code Agent: 实施重构，添加接口抽象
→ Review Agent: 验证重构正确性和测试覆盖
→ Master: 确认无回归，完成
```

---

*此技能通过多代理协作模式，实现复杂编程任务的系统化、高质量交付。*
