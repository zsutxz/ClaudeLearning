# 代码架构分析器 - 详细使用指南

## 技能概述

这是一个专业的代码架构分析技能，能够深入解读各种编程语言和框架的项目架构，生成详细的架构文档，识别设计模式，分析依赖关系，并提供改进建议。

---

## 核心功能模块

### 1. 项目架构识别

**目录结构分析**
- 识别项目的组织方式和架构模式
- 分析源代码、配置、文档、测试的分布
- 识别构建产物和临时文件

**配置文件解析**
- `package.json` (Node.js)
- `requirements.txt`, `setup.py`, `pyproject.toml` (Python)
- `.csproj`, `.sln` (C#/.NET)
- `pom.xml`, `build.gradle` (Java)
- `go.mod`, `go.sum` (Go)
- `Packages/manifest.json` (Unity)

**构建流程分析**
- 识别构建脚本 (Makefile, CMakeLists.txt, Dockerfile)
- CI/CD 配置 (.github/workflows, .gitlab-ci.yml)
- 部署配置 (k8s, docker-compose)

**技术栈识别**
- 编程语言版本
- 框架和库
- 数据库和存储
- 第三方服务集成

### 2. 代码质量分析

**设计模式识别**
- 创建型模式：单例、工厂、建造者、原型
- 结构型模式：适配器、装饰器、代理、组合
- 行为型模式：观察者、策略、命令、状态、模板方法

**代码结构评估**
- 类的职责单一性 (SRP)
- 方法的复杂度 (圈复杂度 < 10)
- 模块间的耦合度
- 代码重复度

**命名规范检查**
- 类名、方法名、变量名的一致性
- 遵循语言命名约定
- 可读性和语义清晰度

**最佳实践建议**
- 符合语言特性的编码规范
- SOLID 原则遵循情况
- 错误处理和异常管理
- 日志和调试友好性

### 3. 依赖关系分析

**模块依赖图**
- 生成模块间的依赖关系树
- 识别核心模块和边缘模块
- 分析模块的层次结构

**包管理分析**
- 外部依赖的版本管理
- 依赖兼容性检查
- 已知安全漏洞识别

**循环依赖检测**
- 识别潜在的循环引用
- 分析循环的影响范围
- 提供解耦建议

**架构层次分析**
- 表现层 (UI/Controllers)
- 业务层 (Services/UseCases)
- 数据层 (Repositories/DataAccess)
- 层次间的依赖规则

### 4. 多语言支持

#### Python 项目
**框架识别**
- Django (MVT 模式, ORM, Middleware)
- Flask (Blueprint, Application Factory)
- FastAPI (依赖注入, 路由器)

**AI/ML 项目**
- 数据处理管道 (ETL, 特征工程)
- 模型管理 (版本控制, 训练/推理分离)
- 实验追踪 (MLflow, Weights & Biases)

#### JavaScript/TypeScript 项目
**前端框架**
- React (Hooks, Context, HOC)
- Vue (组件, Mixins, Provide/Inject)
- Angular (依赖注入, 装饰器, RxJS)

**Node.js 后端**
- Express/Koa 中间件模式
- 事件驱动架构 (EventEmitter)
- 模块系统 (CommonJS, ES Modules)

#### C#/.NET 项目
**Unity 游戏**
- 组件系统 (MonoBehaviour)
- 对象池模式
- 事件系统 (UnityEvent, Action, delegate)
- ScriptableObject 配置

**ASP.NET 应用**
- 仓储模式 (Repository)
- 工作单元 (Unit of Work)
- CQRS (命令查询分离)
- 中间件管道

#### Java 项目
**Spring Boot**
- 依赖注入 (@Autowired, @Component)
- MVC 模式 (@Controller, @Service, @Repository)
- AOP (面向切面编程)
- Spring Data JPA

#### Go 项目
- 接口隔离原则
- 并发模式 (goroutine, channel)
- 结构体组合

---

## 使用指南

### 基础分析

```
请分析这个项目的整体架构
```

**输出：**
- 项目类型识别
- 主要技术栈
- 基本架构模式
- 关键发现摘要

### 完整架构分析

```
对这个项目进行全面的架构分析，包括：
1. 生成详细的架构文档
2. 识别所有使用的设计模式
3. 分析模块间的依赖关系
4. 提供架构改进建议
5. 评估代码质量和可维护性
```

**输出：**
- 执行摘要
- 项目结构分析
- 技术栈详解
- 架构模式识别
- 代码质量评估
- 依赖关系分析
- 改进建议（按优先级）

### 特定问题分析

#### Unity 性能分析
```
分析这个Unity项目的性能瓶颈，重点关注：
1. 内存分配和GC压力
2. 渲染优化机会
3. 组件通信效率
4. 资源加载策略
```

#### Python Web 应用分析
```
分析这个Django应用的架构：
1. MVT模式的应用
2. ORM使用情况
3. 中间件配置
4. 代码组织质量
```

#### React 前端分析
```
分析这个React项目的前端架构：
1. 组件结构和层次
2. 状态管理方案
3. Hooks使用模式
4. 性能优化机会
```

---

## 分析流程详解

### 阶段 1：项目扫描和识别

1. **扫描项目根目录**
   ```
   - 识别配置文件
   - 检测项目类型指示符
   - 建立文件树结构
   ```

2. **技术栈检测**
   ```
   - 解析依赖文件
   - 识别框架版本
   - 检测构建工具
   ```

3. **架构模式识别**
   ```
   - 确定架构风格 (MVC/微服务/分层等)
   - 识别目录组织模式
   - 检测特定框架约定
   ```

4. **专用分析器调用**
   ```
   Unity     → unity_analyzer.py
   Python     → python_analyzer.py
   Frontend   → frontend_analyzer.py
   通用       → 基础分析流程
   ```

### 阶段 2：深度代码分析

1. **核心模块分析**
   ```
   - 识别主要功能模块
   - 分析模块职责划分
   - 评估模块独立性
   ```

2. **设计模式检测**
   ```
   - 搜索模式特征代码
   - 分析模式实现方式
   - 评估模式应用正确性
   ```

3. **代码质量评估**
   ```
   - 可维护性分析
   - 可扩展性评估
   - 性能考虑
   - 安全性检查
   ```

### 阶段 3：架构文档生成

1. **架构概览**
   ```
   - 高层次架构描述
   - 技术栈总结
   - 关键特性
   ```

2. **模块详细说明**
   ```
   - 每个模块的职责
   - 模块接口定义
   - 模块间交互
   ```

3. **依赖关系图**
   ```
   - 模块依赖树
   - 调用关系图
   - 数据流向
   ```

4. **改进建议**
   ```
   - P0: 严重问题、安全漏洞、性能瓶颈
   - P1: 代码质量问题、维护性问题
   - P2: 最佳实践建议、优化机会
   ```

---

## 输出报告格式

```markdown
# 项目架构分析报告

## 执行摘要

- **项目类型**: Python AI项目
- **技术栈**: Python 3.13, LangGraph, OpenAI GPT
- **架构风格**: 工作流模式 + 代理协作
- **关键发现**:
  - ✅ 清晰的模块分离
  - ⚠️ 缺少错误处理
  - ⚠️ 需要添加测试

## 1. 项目结构分析

### 目录组织
```
project/
├── src/           # 源代码
├── tests/         # 测试文件
├── docs/          # 文档
└── config/        # 配置文件
```

### 配置文件解析
- `requirements.txt`: 列出所有Python依赖
- `.env`: 环境变量配置
- `pyproject.toml`: 项目元数据

### 构建流程
- 使用标准Python包管理
- 无CI/CD配置

### 部署架构
- 本地开发环境
- 无容器化配置

## 2. 技术栈分析

### 编程语言
- Python 3.13

### 框架和库
- LangGraph (工作流编排)
- LangChain (AI应用框架)
- OpenAI API (语言模型)

### 数据存储
- JSON文件存储
- 无数据库集成

### 第三方服务
- OpenAI API
- Anthropic API

## 3. 架构模式识别

### 设计模式
- **工作流模式**: 基于LangGraph的状态机
- **代理模式**: 专业化AI代理协作
- **策略模式**: 可插拔的工具集成

### 架构风格
- 事件驱动架构
- 管道和过滤器模式

### 数据流
```
用户输入 → 工作流引擎 → 代理处理 → 工具调用 → 结果返回
```

### 控制流
- 基于状态的转换
- 异步处理支持

## 4. 代码质量评估

### 代码组织
- ✅ 清晰的模块划分
- ✅ 单一职责原则
- ⚠️ 部分函数过长

### 命名规范
- ✅ 遵循PEP 8
- ✅ 语义化命名
- ✅ 一致性良好

### 复杂度分析
- 平均圈复杂度: 5 (良好)
- 最大函数长度: 45行 (可接受)

### 测试覆盖
- ❌ 缺少单元测试
- ❌ 无集成测试

## 5. 依赖关系分析

### 模块依赖图
```
workflow_engine
    ├── research_agent
    ├── learning_agent
    └── tools (MCP集成)
```

### 外部依赖分析
- `langgraph`: 最新稳定版
- `langchain`: 版本兼容
- ⚠️ 未发现已知安全漏洞

### 潜在问题
- 无循环依赖
- 依赖耦合度适中

## 6. 改进建议

### P0 - 必须修复
1. **添加错误处理**
   - 所有API调用需要try-catch
   - 实现重试机制
   - 添加日志记录

2. **添加测试**
   - 单元测试覆盖 > 80%
   - 集成测试关键流程
   - 使用pytest框架

### P1 - 应该修复
1. **配置管理**
   - 使用配置文件替代硬编码
   - 环境变量管理
   - 添加配置验证

2. **文档完善**
   - 添加API文档
   - 完善README
   - 添加示例代码

### P2 - 可以优化
1. **性能优化**
   - 实现结果缓存
   - 异步处理优化
   - 资源池化

2. **代码质量**
   - 添加类型注解
   - 使用mypy类型检查
   - 代码格式化 (black)
```

---

## 专项分析示例

### Unity 项目分析示例

**输入:**
```
分析这个Unity项目的架构，重点关注性能优化
```

**输出:**
```markdown
## Unity项目架构分析

### 技术栈
- **Unity版本**: 2022.3.5f1
- **脚本后端**: Mono IL2CPP
- **渲染管线**: Built-in Render Pipeline
- **依赖包**: 无外部Package依赖

### 架构模式
- **MVC模式**: 清晰的模型-视图-控制器分离
- **对象池模式**: 高效的GameObject重用机制
- **事件驱动**: 松耦合的组件通信
- **状态机**: 游戏状态管理

### 核心模块
1. **Animation模块** (`Animation/`)
   - BasicCoinAnimation: 金币动画控制器
   - 支持直线、抛物线、收集三种动画类型

2. **管理器模块** (`Examples/`)
   - SimpleCoinManager: 金币生命周期管理
   - BasicCoinDemo: 功能演示和测试

### 性能特征
- **对象池化**: 减少GC压力，支持50+并发动画
- **协程驱动**: 非阻塞的动画执行
- **轻量设计**: 仅4个核心文件，极简架构

### 优化建议
- ✅ 已实现对象池
- ⚠️ 可添加对象预加载
- ⚠️ 考虑使用对象池管理器
```

---

## 注意事项

### 分析精度
- ✅ **高置信度**: 明确的设计模式、标准项目结构
- ⚠️ **中置信度**: 推断的架构意图、常见设计选择
- ❓ **低置信度**: 复杂自定义模式、特定业务逻辑

### 性能考虑
- 大型项目分析可能需要较长时间
- 建议先分析核心目录，再逐步扩展
- 可以通过过滤文件类型提高效率

### 安全性
- ✅ 仅进行静态分析，不执行代码
- ✅ 敏感配置文件会被识别但不展示内容
- ✅ 分析结果不包含API密钥等敏感信息

---

## 配置文件说明

### patterns.yaml
技能包含 `config/patterns.yaml`，定义了：
- 7种语言的常见架构模式
- 23种设计模式的识别规则
- SOLID原则的检测指标
- 反模式的识别特征
- 质量指标的基准值

### analyzers/
专用分析器目录：
- `python_analyzer.py` - Python项目专用分析
- `frontend_analyzer.py` - 前端项目专用分析
- `unity_analyzer.py` - Unity项目专用分析

### scripts/
- `analyze-project.py` - 完整的Python分析脚本，可独立运行

---

## 质量保证

### 分析可信度等级
| 等级 | 描述 | 示例 |
|------|------|------|
| 高 | 明确的模式、标准结构 | Django MVT、React Hooks |
| 中 | 推断的意图、常见选择 | 分层架构、仓储模式 |
| 低 | 复杂自定义、特定业务 | 自定义DSL、领域逻辑 |

### 建议优先级
- **P0**: 严重架构问题、安全漏洞、性能瓶颈
- **P1**: 代码质量问题、维护性问题
- **P2**: 最佳实践建议、优化机会

---

*代码架构分析师 - 深度理解项目设计，洞察技术架构精髓*
