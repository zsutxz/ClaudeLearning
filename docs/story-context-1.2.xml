<story-context id="bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>1</epicId>
    <storyId>2</storyId>
    <title>Basic Animation System and Coroutine Implementation</title>
    <status>Done</status>
    <generatedAt>2025-10-30</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/story-1.2.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Unity developer</asA>
    <iWant>implement a lightweight coin animation system using pure Unity coroutines</iWant>
    <soThat>I can create smooth coin collection effects without any external dependencies</soThat>
    <tasks>4 main tasks: Coroutine Animation Framework, Collection Animation System, Motion Easing Patterns, Integration Testing and Validation</tasks>
  </story>

  <acceptanceCriteria>1. System must implement Unity coroutine-based animation framework for coin movement
2. Multi-phase collection animation (scale up → move → scale down) must be functional
3. Built-in mathematical easing functions must provide smooth natural motion effects
4. Animation state management (Idle, Moving, Collecting, Pooled) must be functional
5. Coins must animate smoothly to target positions and collection points</acceptanceCriteria>

  <artifacts>
    <docs>
      <doc path="docs/tech-spec-epic-mvp-2025-10-29.md" title="Technical Specification: Responsive Intelligent Coin Animation System MVP" section="Services and Modules" snippet="Core Animation Manager (CoinAnimationManager) - Central coordination of all coin animations, performance monitoring, and system lifecycle management"/>
      <doc path="docs/tech-spec-epic-mvp-2025-10-29.md" title="Technical Specification: Responsive Intelligent Coin Animation System MVP" section="Data Models and Contracts" snippet="CoinAnimationState - State machine definitions (Idle, Moving, Collecting, Paused, Pooled)"/>
      <doc path="docs/tech-spec-epic-mvp-2025-10-29.md" title="Technical Specification: Responsive Intelligent Coin Animation System MVP" section="Data Models and Contracts" snippet="PerformanceMetrics - Performance monitoring data structure"/>
      <doc path="docs/tech-spec-epic-mvp-2025-10-29.md" title="Technical Specification: Responsive Intelligent Coin Animation System MVP" section="APIs and Interfaces" snippet="ICoinAnimationManager - Basic system interface"/>
      <doc path="docs/PRD.md" title="Product Requirements Document" section="Functional Requirements" snippet="FR002: Developers can configure animation parameters through inspector interface with zero external dependencies"/>
    </docs>
    <code>
      <artifact path="Assets/Scripts/Animation/CoinAnimationController.cs" kind="class" symbol="CoinAnimationController" lines="296" reason="Individual coin controller with coroutine-based movement">
        <component path="Assets/Scripts/Animation/CoinAnimationController.cs:AnimateToPosition" kind="method" symbol="CoroutineAnimation" lines="45" reason="Move with easing and rotation"/>
        <component path="Assets/Scripts/Animation/CoinAnimationController.cs:CollectCoin" kind="method" symbol="MultiPhaseAnimation" lines="78" reason="Multi-phase collection animation"/>
        <component path="Assets/Scripts/Animation/CoinAnimationController.cs:StopCurrentAnimation" kind="method" symbol="AnimationControl" lines="12" reason="Stop any running animation"/>
      </artifact>
      <artifact path="Assets/Scripts/Animation/CoinAnimationManager.cs" kind="class" symbol="CoinAnimationManager" lines="136" reason="Simple singleton manager for coin coordination">
        <component path="Assets/Scripts/Animation/CoinAnimationManager.cs:SpawnCoin" kind="method" symbol="CoinSpawning" lines="28" reason="Create and initialize coin objects"/>
        <component path="Assets/Scripts/Animation/CoinAnimationManager.cs:CollectAllCoins" kind="method" symbol="BatchCollection" lines="34" reason="Collect all active coins"/>
      </artifact>
      <artifact path="Assets/Scripts/Core/CoinAnimationState.cs" kind="enum" symbol="CoinAnimationState" lines="15" reason="State machine definitions">
        <component path="Assets/Scripts/Core/CoinAnimationState.cs:Idle" kind="enum-value" symbol="IdleState" reason="Coin is not animating"/>
        <component path="Assets/Scripts/Core/CoinAnimationState.cs:Moving" kind="enum-value" symbol="MovingState" reason="Coin is moving to target position"/>
        <component path="Assets/Scripts/Core/CoinAnimationState.cs:Collecting" kind="enum-value" symbol="CollectingState" reason="Coin is being collected"/>
        <component path="Assets/Scripts/Core/CoinAnimationState.cs:Pooled" kind="enum-value" symbol="PooledState" reason="Coin is ready for reuse"/>
      </artifact>
    </code>
    <dependencies>
      <dependency ecosystem="Unity" package="Unity Engine" version="2021.3 LTS+" description="Core Unity engine for coroutine system"/>
      <dependency ecosystem="Unity" package="Unity Test Framework" version="1.3+" description="Automated testing framework for unit and integration tests"/>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint type="Architecture" description="Use event-driven architecture for decoupled communication between components"/>
    <constraint type="Pattern" description="Implement singleton pattern for CoinAnimationManager coordination"/>
    <constraint type="Design" description="Follow modular design separating core, animation, and example systems"/>
    <constraint type="Performance" description="Target 60fps performance with 50+ concurrent coins on minimum specification hardware"/>
    <constraint type="Memory" description="Total memory usage must not exceed 20MB for 50 concurrent coins"/>
    <constraint type="Testing" description="Unit tests for coroutine animation calculations with 80% coverage target"/>
    <constraint type="Unity" description="Support Unity 2021.3 LTS and later versions"/>
    <constraint type="Platform" description="Cross-platform compatibility for Windows, macOS, and Linux"/>
    <constraint type="Dependencies" description="Zero external dependencies - pure Unity coroutines only"/>
  </constraints>

  <interfaces>
    <interface name="ICoinAnimationManager" kind="interface" signature="void SpawnCoin(Vector3 position); void CollectAllCoins(Vector3 collectionPoint); PerformanceMetrics GetPerformanceMetrics();" path="docs/tech-spec-epic-mvp-2025-10-29.md"/>
    <interface name="ICoinAnimationController" kind="interface" signature="void AnimateToPosition(Vector3 targetPosition, float duration); void CollectCoin(Vector3 collectionPoint, float duration); void StopCurrentAnimation();" path="docs/tech-spec-epic-mvp-2025-10-29.md"/>
    <interface name="IPerformanceMonitor" kind="interface" signature="void StartMonitoring(); PerformanceMetrics GetCurrentMetrics(); event UnityAction&lt;PerformanceTier&gt; OnPerformanceTierChanged;" path="docs/tech-spec-epic-mvp-2025-10-29.md"/>
  </interfaces>

  <tests>
    <standards>Use Unity Test Framework v1.3+ with NUnit for unit testing. Target 80% coverage for core business logic (coroutine calculations, animation management) and 60% for utility classes. Focus on coroutine animation lifecycle management, performance monitoring calculations, and state machine transitions.</standards>
    <locations>Tests should be placed in Assets/Tests/ directory with subdirectories: UnitTests/ for component testing, IntegrationTests/ for system interactions, and PerformanceTests/ for stress testing and benchmarking.</locations>
    <ideas>
      <test idea="Coroutine animation performance" mappedTo="AC-1,AC-4">Benchmark animation sequences with varying coin counts to validate 60fps target performance</test>
      <test idea="Multi-phase collection animation" mappedTo="AC-2,AC-5">Verify complete scale-up → move → scale-down sequence works correctly</test>
      <test idea="Easing functions validation" mappedTo="AC-3">Test mathematical easing functions (EaseOutQuad, EaseOutBack, EaseInSine, EaseInBack) for smooth motion</test>
      <test idea="State machine transitions" mappedTo="AC-4">Validate animation state transitions between Idle, Moving, Collecting, and Pooled states</test>
    </ideas>
  </tests>
</story-context>