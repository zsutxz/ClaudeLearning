# Story 1.2: Implement Piece Placement Logic

## Status
Ready for Review

## Story
**As a** player,
**I want** to place pieces on the board by clicking on intersections,
**so that** I can play the Gomoku game.

## Acceptance Criteria
1. Players can place black and white pieces alternately on the board
2. Pieces can only be placed on empty intersections
3. Invalid placements (occupied intersections, off-board clicks) are ignored
4. The current player is clearly indicated in the UI
5. The board state is properly updated after each valid placement

## Tasks / Subtasks
- [x] Implement piece placement mechanics (AC: 1, 2, 3)
  - [x] Add mouse input handling for board clicks
  - [x] Convert click positions to board coordinates
  - [x] Validate placement positions
  - [x] Implement turn-based piece placement
- [x] Update board state management (AC: 5)
  - [x] Update internal board state array when pieces are placed
  - [x] Ensure board state consistency between visualization and logic
- [x] Implement player turn management (AC: 1, 4)
  - [x] Track current player (black/white)
  - [x] Switch player after valid placement
  - [x] Display current player in UI
- [x] Add input validation and error handling (AC: 3)
  - [x] Prevent placement on occupied intersections
  - [x] Ignore clicks outside the board boundaries
  - [x] Handle edge cases gracefully

## Dev Notes
### Component Specifications
- Extend the existing BoardManager component to handle piece placement logic
- Use Unity's input system for mouse click detection
- BoardManager should maintain both visual and logical board states [Source: architecture/full-stack-architecture.md#4.2 BoardManager]
- GameManager will coordinate player turns and game state [Source: architecture/full-stack-architecture.md#4.1 GameManager]

### File Locations
- Main board logic script: `Assets/Scripts/Core/BoardManager.cs`
- Game management script: `Assets/Scripts/Core/GameManager.cs`
- Input handling: `Assets/Scripts/Core/InputManager.cs` (may need to create)

### Technical Constraints
- Use Unity 2022.3 LTS as specified in the tech stack
- Follow component-based architecture as outlined in the architecture document
- Implement singleton pattern for GameManager for global access [Source: architecture/full-stack-architecture.md#3.2 Component Diagram]
- Use the existing board state array in BoardManager for tracking piece positions [Source: architecture/full-stack-architecture.md#4.2 BoardManager]

### Testing
- Test alternating piece placement for black and white players
- Verify that pieces cannot be placed on occupied intersections
- Confirm that clicks outside the board are ignored
- Validate that the board state is correctly updated after each placement
- Test player turn switching functionality

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2025-10-02 | 1.0 | Initial story creation | Scrum Master |
| 2025-10-02 | 1.1 | Piece placement logic implementation complete | Developer |

## Dev Agent Record

### Agent Model Used
Claude Code (qwen/qwen3-coder-480b-a35b-instruct)

### Debug Log References

### Completion Notes List
- Created InputManager.cs to handle mouse input for piece placement
- Updated visualization BoardManager.cs to work with core BoardManager
- Implemented piece placement logic with validation
- Added turn-based player management
- Created visual representation of placed pieces
- Updated Board prefab to include both visualization and core BoardManager components
- Updated MainGame scene to include all necessary components

### File List
- UnityProject/Assets/Scripts/Core/InputManager.cs
- UnityProject/Assets/Scripts/Core/GameManager.cs
- UnityProject/Assets/Scripts/Core/BoardManager.cs
- UnityProject/Assets/Scripts/BoardManager.cs
- UnityProject/Assets/Prefabs/Board.prefab
- UnityProject/Assets/Scenes/MainGame.unity

## QA Results