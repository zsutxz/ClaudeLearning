# Story 3.3: Implement Alternative Win Conditions

## Status
Ready for Review

## Story
**As a** player,
**I want** to configure alternative win conditions before starting a game,
**so that** I can customize my gameplay experience with different victory rules.

## Acceptance Criteria
1. Players can select from multiple win conditions (Standard 5-in-a-row, Capture, Time-based) before starting a game
2. The selected win condition is properly applied to the game logic
3. Game properly handles different win conditions in gameplay and UI
4. Default win condition is Standard 5-in-a-row if no selection is made

## Tasks / Subtasks
- [x] Implement win condition selection UI (AC: 1)
  - [x] Create dropdown or button group for win condition options
  - [x] Add descriptions for each win condition option
  - [x] Ensure UI is accessible and user-friendly
- [x] Implement win condition configuration logic (AC: 2, 3)
  - [x] Update WinDetector to support different win conditions
  - [x] Modify win detection algorithms based on selected condition
  - [x] Ensure win detection works correctly with all conditions
- [x] Integrate win condition selection with game start (AC: 1, 2, 4)
  - [x] Pass selected win condition to GameManager on game start
  - [x] Implement default win condition handling
  - [x] Ensure win condition is applied before game initialization
- [x] Update UI elements for different win conditions (AC: 3)
  - [x] Verify UI displays properly for different win conditions
  - [x] Update game rules display based on selected condition
  - [x] Ensure win condition is clearly communicated to players
- [x] Testing and validation (All ACs)
  - [x] Test all win conditions function correctly
  - [x] Verify UI displays properly for different conditions
  - [x] Confirm win detection works across all conditions

## Dev Notes
### Previous Story Insights
From Story 3.1: BoardManager already supports different board sizes through its InitializeBoard method. From Story 3.2: UIManager handles theme selection in settings. These patterns can be extended for win condition selection.

### Component Specifications
- Extend the existing WinDetector component to support different win conditions [Source: architecture/full-stack-architecture.md#4.3 WinDetector]
- Update GameManager to accept win condition parameter during game initialization [Source: architecture/full-stack-architecture.md#4.1 GameManager]
- Update UIManager to include win condition selection in settings [Source: architecture/full-stack-architecture.md#4.4 UIManager]
- Use Unity UI elements (Dropdown or Toggle Group) for win condition selection [Source: architecture/full-stack-architecture.md#2.1 Primary Technologies]

### File Locations
- Win detection script: `Assets/Scripts/Core/WinDetector.cs`
- Game management script: `Assets/Scripts/Core/GameManager.cs`
- UI management script: `Assets/Scripts/UI/UIManager.cs`
- Settings UI: `Assets/UI/SettingsPanelWithButtons.prefab`
- Main scene: `Assets/Scenes/MainGame.unity`

### Technical Constraints
- Use Unity 2022.3 LTS as specified in the tech stack [Source: architecture/full-stack-architecture.md#2.1 Primary Technologies]
- Follow component-based architecture as outlined in the architecture document [Source: architecture/full-stack-architecture.md#3.2 Component Diagram]
- Implement singleton pattern for GameManager and UIManager for global access [Source: architecture/full-stack-architecture.md#4.1 GameManager]
- Support configurable win conditions through enum or configuration object [Source: architecture/full-stack-architecture.md#4.3 WinDetector]

### Win Condition Specifications
- **Standard 5-in-a-row**: Traditional Gomoku win condition (already implemented)
- **Capture**: Players can capture opponent pieces by surrounding them (requires additional logic)
- **Time-based**: Game ends after a time limit, player with most pieces wins (requires timer implementation)

### Project Structure Notes
- The existing WinDetector component needs to be extended to support multiple win conditions
- GameManager should store the current win condition setting
- UIManager should handle win condition selection similar to board size selection
- Settings UI should be updated to include win condition options

## Testing
### Testing Standards
- Test all three win conditions (Standard, Capture, Time-based) for proper functionality
- Verify UI displays correctly for different win conditions
- Confirm win detection works properly with all win conditions
- Test edge cases and boundary conditions for each win condition
- Validate that default win condition is applied correctly
- Test win condition persistence between game sessions

### Test File Location
- Test files should be placed in: `Assets/Scripts/Core/`
- Use Unity Test Framework for automated testing
- Create specific test cases for each win condition type

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2025-10-04 | 1.0 | Initial story creation | Scrum Master |

## Dev Agent Record

### Agent Model Used
Claude Code (deepseek-chat)

### Debug Log References
- File editing issues with WinDetector.cs due to line ending differences
- Successfully resolved by rewriting entire file with updated CheckWin method

### Completion Notes List
- ✅ Implemented win condition selection UI in UIManager.cs
- ✅ Added win condition buttons and selection logic
- ✅ Updated WinDetector.cs to support multiple win condition types
- ✅ Added helper methods for capture and time-based win conditions
- ✅ Integrated win condition selection with game start in GameManager.cs
- ✅ Updated UI elements to display win condition specific information
- ✅ Added timer support for time-based win conditions
- ✅ Implemented capture detection logic in BoardManager.cs
- ✅ Added capture event handling in GameManager.cs
- ✅ Added capture visualization in BoardViewManager.cs
- ✅ Created WinConditionValidationTest.cs for testing

### File List
- `UnityProject/Assets/Scripts/UI/UIManager.cs` - Added win condition UI and selection logic
- `UnityProject/Assets/Scripts/Core/GameManager.cs` - Added win condition integration and timer support
- `UnityProject/Assets/Scripts/Core/WinDetector.cs` - Updated to support multiple win conditions
- `UnityProject/Assets/Scripts/Core/BoardManager.cs` - Added capture detection logic
- `UnityProject/Assets/Scripts/UI/BoardViewManager.cs` - Added capture visualization
- `UnityProject/Assets/Scripts/Core/WinConditionValidationTest.cs` - Created validation test

## QA Results
- All three win conditions implemented: Standard, Capture, Time-based
- UI properly displays win condition selection and descriptions
- Game logic correctly handles different win condition types
- Default win condition (Standard) applied when no selection made
- Settings persistence working through PlayerPrefs
- UI updates dynamically based on selected win condition