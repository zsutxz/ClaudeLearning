# Story 1.3: Implement Win Detection

## Status
Ready for Review

## Story
**As a** player,
**I want** the game to detect when I have won by getting five pieces in a row,
**so that** I know when I've won the game.

## Acceptance Criteria
1. The game correctly detects horizontal wins (5 consecutive pieces in a row)
2. The game correctly detects vertical wins (5 consecutive pieces in a column)
3. The game correctly detects diagonal wins (5 consecutive pieces diagonally)
4. The game declares a winner immediately after a winning move is made
5. The game correctly identifies which player has won

## Tasks / Subtasks
- [x] Implement horizontal win detection (AC: 1)
  - [x] Check for 5 consecutive pieces in each row
  - [x] Optimize detection to only check around the last placed piece
- [x] Implement vertical win detection (AC: 2)
  - [x] Check for 5 consecutive pieces in each column
  - [x] Optimize detection to only check around the last placed piece
- [x] Implement diagonal win detection (AC: 3)
  - [x] Check for 5 consecutive pieces in both diagonal directions
  - [x] Optimize detection to only check around the last placed piece
- [x] Integrate win detection with game flow (AC: 4, 5)
  - [x] Call win detection after each valid piece placement
  - [x] Declare winner when win condition is met
  - [x] Display winning player information

## Dev Notes
### Component Specifications
- Extend the existing WinDetector component to implement win detection algorithms
- WinDetector should check for wins after each piece placement [Source: architecture/full-stack-architecture.md#4.3 WinDetector]
- GameManager will coordinate win detection and game state changes [Source: architecture/full-stack-architecture.md#4.1 GameManager]

### File Locations
- Win detection script: `Assets/Scripts/Core/WinDetector.cs`
- Game management script: `Assets/Scripts/Core/GameManager.cs`

### Technical Constraints
- Use Unity 2022.3 LTS as specified in the tech stack
- Follow component-based architecture as outlined in the architecture document
- Implement efficient win detection algorithms that only check around the last placed piece
- Use the existing board state array in BoardManager for checking win conditions [Source: architecture/full-stack-architecture.md#4.2 BoardManager]

### Testing
- Test horizontal win detection in various positions
- Test vertical win detection in various positions
- Test diagonal win detection in both directions
- Verify that wins are detected immediately after the winning move
- Test that non-winning sequences of 4 or fewer pieces do not trigger win detection

## Change Log
| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2025-10-02 | 1.0 | Initial story creation | Scrum Master |
| 2025-10-02 | 1.1 | Win detection implementation complete | Developer |

## Dev Agent Record

### Agent Model Used
Claude Code (qwen/qwen3-coder-480b-a35b-instruct)

### Debug Log References

### Completion Notes List
- Win detection logic was already partially implemented in WinDetector.cs
- Integrated WinDetector with GameManager and InputManager
- Added win detection calls to InputManager after each move
- Added win condition handling with debug output
- Updated MainGame scene to include WinDetector component

### File List
- UnityProject/Assets/Scripts/Core/WinDetector.cs
- UnityProject/Assets/Scripts/Core/GameManager.cs
- UnityProject/Assets/Scripts/Core/InputManager.cs
- UnityProject/Assets/Scenes/MainGame.unity

## QA Results